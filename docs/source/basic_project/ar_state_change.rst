.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _ar_state_change:

5.3 ã‚¹ãƒ†ãƒ¼ãƒˆå¤‰æ›´ã®æ¤œå‡º
===========================

ãƒœã‚¿ãƒ³ãŒä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹éš›ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹é–“ã ã‘å‹•ä½œã™ã‚‹ã‚ã‘ã§ã¯ãªãã€é›¢ã•ã‚Œã‚‹ã¨å‹•ä½œãŒåœæ­¢ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ãŸã³ã«å‹•ä½œçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ã“ã®åŠ¹æœã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã‚ªãƒ•ã¨ã‚ªãƒ³ã®é–“ã§å‹•ä½œçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æ–¹æ³•ã‚’çŸ¥ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ãã‚Œã¯ã€Œã‚¹ãƒ†ãƒ¼ãƒˆå¤‰æ›´ã®æ¤œå‡ºã€ã¨è¨€ã„ã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

**å¿…è¦ãªéƒ¨å“**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å¿…è¦ãªéƒ¨å“ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ã‚­ãƒƒãƒˆå…¨ä½“ã‚’è³¼å…¥ã™ã‚‹ã®ã¯éå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åç§°	
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - 3 in 1 Starter Kit
        - 380+
        - |link_3IN1_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_uno`
        - |link_Uno_R3_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_button`
        - |link_button_buy|
    *   - :ref:`cpn_tt_motor`
        - \-
    *   - :ref:`cpn_l9110`
        - \-

**å›è·¯å›³**

.. image:: img/circuit_8.3_statechange.png

**é…ç·šå›³**

.. image:: img/5.3_state_change_l9110_bb.png
    :width: 800
    :align: center

**ã‚³ãƒ¼ãƒ‰**

.. note::

    * ``3in1-kit\basic_project\5.3.state_change_detection`` ã®ãƒ‘ã‚¹ã®ä¸‹ã«ã‚ã‚‹ ``5.3.state_change_detection.ino`` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¾ã™ã€‚
    * ã¾ãŸã¯ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ **Arduino IDE** ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
    
    * ã¾ãŸã¯ã€ `Arduino Web Editor <https://docs.arduino.cc/cloud/web-editor/tutorials/getting-started/getting-started-web-editor>`_ ã‚’é€šã˜ã¦ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

.. raw:: html
    
    <iframe src=https://create.arduino.cc/editor/sunfounder01/67a62a3d-46d3-4f5f-889c-364cbdf9b66f/preview?embed style="height:510px;width:100%;margin:10px 0" frameborder=0></iframe>
    
ã‚³ãƒ¼ãƒ‰ãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒå›è»¢ã—ã€å†ã³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒåœæ­¢ã—ã¾ã™ã€‚

**ã©ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã®ã‹ï¼Ÿ**

1. ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚„ãƒœã‚¿ãƒ³ã®ãƒ”ãƒ³ã®å¤‰æ•°ã‚’ä½œæˆã—ã€ãƒ”ãƒ³ã‚’å®šç¾©ã—ã¾ã™ã€‚

    .. code-block:: arduino

        ...
        int detectionState = 0;   
        int buttonState = 0;         
        int lastButtonState = 0;    

    * ``detectionState`` is a flag whose value changes each time the button is pressed, e.g., 0 this time, 1 the next, and so on alternately.
    * ``buttonState`` and ``lastButtonState`` are used to record the state of the button this time and the last time, to compare whether the button was pressed or released.

#. å„ãƒ”ãƒ³ã‚’åˆæœŸåŒ–ã—ã€ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã®ãƒœãƒ¼ãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚

    .. code-block:: arduino

        void setup() {
            pinMode(buttonPin, INPUT);
            Serial.begin(9600);
            pinMode(B_1A, OUTPUT);
            pinMode(B_1B, OUTPUT);
        }


#. ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æœ€åˆã«èª­ã¿å–ã‚Šã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€å¤‰æ•° ``detectionState`` ãŒ0ã‹ã‚‰1ã€ã¾ãŸã¯1ã‹ã‚‰0ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚ ``detectionState`` ãŒ1ã®å ´åˆã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒå›è»¢ã—ã¾ã™ã€‚ã“ã®å›è·¯ã®åŠ¹æœã¯ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ãŸã³ã«ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒå›è»¢ã—ã€æ¬¡ã«ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒåœæ­¢ã™ã‚‹ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

    .. code-block:: arduino

        void loop() {
            // Toggle the detectionState each time the button is pressed
            buttonState = digitalRead(buttonPin);
            if (buttonState != lastButtonState) {
                if (buttonState == HIGH) {
                detectionState=(detectionState+1)%2;
                Serial.print("The detection state is: ");
                Serial.println(detectionState);
                } 
                delay(50);
            }
            lastButtonState = buttonState;

            // According to the detectionState, start the motor
            if(detectionState==1){
                digitalWrite(B_1A,HIGH);
                digitalWrite(B_1B,LOW);
            }else{
                digitalWrite(B_1A,LOW);
                digitalWrite(B_1B,LOW);
            }
        }

å…¨ä½“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

    * ãƒœã‚¿ãƒ³ã®å€¤ã‚’èª­ã¿å–ã‚Šã¾ã™ã€‚

    .. code-block:: arduino

        buttonState = digitalRead(buttonPin);

    * ``buttonState`` ã¨ ``lastButtonState`` ãŒç­‰ã—ããªã„å ´åˆã€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚ŒãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚æ¬¡ã®åˆ¤æ–­ã‚’ç¶šã‘ã€ã“ã®æ™‚ç‚¹ã®ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’å¤‰æ•° ``lastButtonState`` ã«æ ¼ç´ã—ã¾ã™ã€‚ ``delay(50)`` ã¯ã‚¸ãƒƒã‚¿ã‚’æ’é™¤ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
    
    .. code-block:: arduino

        if (buttonState != lastButtonState) {
        ...
            delay(50);
        }
        lastButtonState = buttonState;

    * ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€ãã®å€¤ã¯HIGHã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€å¤‰æ•° ``detectionState`` ã®å€¤ãŒå¤‰æ›´ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€1ã¤ã®æ“ä½œå¾Œã«0ã‹ã‚‰1ã«ãªã‚Šã¾ã™ã€‚

    .. code-block:: arduino

        if (buttonState == HIGH) {
            detectionState=(detectionState+1)%2;
            Serial.print("The detection state is: ");
            Serial.println(detectionState);
            }

    * å¤‰æ•° ``detectionState`` ãŒ1ã®å ´åˆã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’å›è»¢ã•ã›ã€ãã‚Œä»¥å¤–ã®å ´åˆã¯åœæ­¢ã—ã¾ã™ã€‚

    .. code-block:: arduino

        if(detectionState==1){
            digitalWrite(B_1A,HIGH);
            digitalWrite(B_1B,LOW);
        }else{
            digitalWrite(B_1A,LOW);
            digitalWrite(B_1B,LOW);
        }

